@page "/admin/products/edit/{id}"
@rendermode InteractiveServer
@using MiniEshopBlazor.Models
@inject MiniEshopBlazor.Services.AuthService AuthService
@inject MiniEshopBlazor.Services.ProductService ProductService
@inject NavigationManager Navigation

<h3>Επεξεργασία Προϊόντος</h3>

@if (!AuthService.IsLoggedIn)
{
    <p>Δεν έχετε πρόσβαση.</p>
}
else if (product == null)
{
    <p>Φόρτωση...</p>
}
else
{
    <EditForm Model="product" OnValidSubmit="HandleSave">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label>Όνομα</label>
            <InputText class="form-control" @bind-Value="product.Name" />
        </div>

        <div class="mb-3">
            <label>Περιγραφή</label>
            <InputText class="form-control" @bind-Value="product.Description" />
        </div>

        <div class="mb-3">
            <label>Τιμή</label>
            <InputNumber class="form-control" @bind-Value="product.Price" />
        </div>

        <div class="mb-3">
            <label>Απόθεμα</label>
            <InputNumber class="form-control" @bind-Value="product.Stock" />
        </div>

        <div class="mb-3">
            <label>Κατηγορία</label>
            <InputText class="form-control" @bind-Value="product.Category" />
        </div>

        <div class="mb-3">
            <label>Image URL</label>
            <InputText class="form-control" @bind-Value="product.ImageUrl" />
            <div class="text-muted2" style="margin-top:6px;">
                Παράδειγμα: /images/products/laptop.jpg
            </div>
        </div>

        <button class="btn btn-primary" type="submit">Αποθήκευση</button>
        <button class="btn btn-secondary ms-2" type="button" @onclick="GoBack">Ακύρωση</button>
    </EditForm>
}

@code {
    [Parameter] public string id { get; set; }
    private Product product;

    protected override async Task OnInitializedAsync()
    {
        if (!AuthService.IsLoggedIn)
        {
            Navigation.NavigateTo("/admin");
            return;
        }

        product = await ProductService.GetAsync(id);
    }

    private async Task HandleSave()
    {
        await ProductService.UpdateAsync(product.Id, product);
        Navigation.NavigateTo("/admin/products");
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/admin/products");
    }
}
